{% load static %}
<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoxShop</title>
    <link rel="stylesheet" href="{% static 'TiendaBien/ver-producto-style.css' %}">
</head>
<body>
    <script src="{% static 'TiendaBien/sentencias.js' %}"></script>
    {% include "navbar.html" %}
    <main>
        <div class="contenido-pag">
            
            <div>
                <div  class="btn-return">
                    <img src="{% static 'TiendaBien/img/return.png' %}" alt="" width="15px">
                    <a href="{% url 'busqueda' %}">Regresar</a>
                </div>
            </div>
            <div class="content-product">
                <div class="producto">
                    <div class="img-p">
                        <img src="{{ producto.urlimagen }}" alt="" id="img1">
                    </div>
                    <div class="info-p">
                        
                        <div class="titulo"> <h1>{{ producto.nombre }}</h1> </div>
                        <div>Stock: {{producto.stock}}</div>
                        <div class="div-desc">
                            <p id="t-sub">MX ${{ producto.precio }}</p>
                            {% if producto.descuento != 0 %}
                                <p id="desc">{{ producto.descuento }}% Desc.</p> 
                            {% endif %}
                        </div>
                        <div><p>MX ${{ producto.precioDescuento }}</p></div>
                        <div class="p-rating">
                            <b>{{ producto.estrellas }} Estrellas</b> 
                           
                        </div>
                        <div class="div-color">
                            <p>Color:</p>
                            <div class="colores">
                                <button id="btn-negro"></button>
                                <button id="blanco"></button>
                                <button id="btn-gris"></button>
                                <button id="btn-rosa"></button>
                                <button id="btn-azul"></button>
                            </div>
                        </div>
                        <div class="cantidad">
                            <p>Cantidad</p>
                            <div id="cant">
                                <button onclick="decrementar()">-</button>
                                <p id="cantidad">1</p>
                                <button onclick="incrementar()">+</button>
                            </div>
                        </div>
                        <div class="div-botones">
                            <button type= "submit" id = "btnAnadir"
                            data-producto-id="{{ producto.id }}"
                            data-producto-nombre="{{ producto.nombre }}"
                            data-producto-precio="{{ producto.precio }}"
                            data-producto-urlimagen="{{ producto.urlimagen }}",
                            data=producto-stock="{{ producto.stock }}">
                            <img src="{% static 'TiendaBien/img/add.png' %}" alt="" height="20px">Añadir al carrito</button>
                        </div>
                            
                    </div>
                </div>
               
            </div>
            <div class="content-description">
                <div class="titulo">
                    <p>Descripción</p>
                </div>
    
                <div class="parrafo2">
                    <p>{{ producto.descripcion }}</p> 
                </div>
            </div>
            <div class="content-comments">
                <div id="title-op"><p>Opiniones</p></div>
                <div class="rating">
                    
                    <div class="div-op">
                        <p id="five">5</p>
                        <div class="user-stars">
                            <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                        </div>
                        <p>Todas las revisiones provienen de compradores verificados.</p>
                        
                    </div>
                    <div class="estrellas">
                        <div class="div-barras">
                            <p>5 Estrellas</p>
                            <p class="p-barra" id="full"> </p>
                            <p>126</p>
                        </div>
                        <div class="div-barras">
                            <p>4 Estrellas</p>
                            <p class="p-barra"> </p>
                            <p>0</p>
                        </div>
                        <div class="div-barras">
                            <p>3 Estrellas</p>
                            <p class="p-barra"> </p>
                            <p>0</p>
                        </div>
                        <div class="div-barras">
                            <p>2 Estrellas</p>
                            <p class="p-barra"> </p>
                            <p>0</p>
                        </div>
                        <div class="div-barras">
                            <p>1 Estrellas</p>
                            <p class="p-barra"> </p>
                            <p>0</p>
                        </div>
                        <div class="div-barras">
                            <p>0 Estrellas</p>
                            <p class="p-barra"> </p>
                            <p>0</p>
                        </div>
                    </div>
                </div>
    
                <div class="filtros">
                    <button id="btn-purple">
                        Todo(126)
                    </button>
                    <button class="btn-gray">
                        Más recientes
                    </button>
                    <button class="btn-gray">
                        Más antigüas
                    </button>
                    <button id="btn-black-gray">
                        5 Estrellas (126)
                    </button>
                    <button class="btn-gray">
                        4 Estrellas
                    </button>
                    <button class="btn-gray">
                        3 Estrellas
                    </button>
                    <button class="btn-gray">
                        2 Estrellas
                    </button>
                    <button class="btn-gray">
                        1 Estrellas
                    </button>
                    <button class="btn-gray">
                        0 Estrellas
                    </button>
                </div>
    
                <div class="comments">
                    <div class="comment">
                        <div class="user">
                            <img src="{% static 'TiendaBien/img/user.png' %}" alt="" >
                            <p>Mario</p>
                        </div>
                        <div class="opinion">
                            <div class="user-stars">
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            </div>
                            <p><b>Estoy satifecho con el producto</b></p>
                            <p>Quedé satisfecho con la relación precio-calidad, el material con qué están 
                                hechos son bastante buenos 10/10.</p>
                        </div>
                    </div>
                    <div class="comment">
                        <div class="user">
                            <img src="{% static 'TiendaBien/img/user.png' %}" alt="" >
                            <p>Lucía</p>
                        </div>
                        <div class="opinion">
                            <div class="user-stars">
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            </div>
                            <p><b>Me encantó</b></p>
                            <p>ES  de los mejores  que he comprado, los volvería a comprar.</p>
                        </div>
                    </div>
                    <div class="comment">
                        <div class="user">
                            <img src="{% static 'TiendaBien/img/user.png' %}" alt="" >
                            <p>Juan</p>
                        </div>
                        <div class="opinion">
                            <div class="user-stars">
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                                <img src="{% static 'TiendaBien/img/orange-star.png' %}" alt="" >
                            </div>
                            <p><b>Excelentes</b></p>
                            <p>Compré esto como regalo para mi esposa y ella quedó fascinada, pienso pedirme unos para mí también.</p>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </main>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Obtener el nombre de usuario del Local Storage
        const nombreUsuario = localStorage.getItem('nombreUsuario');
    
        // Asignar el nombre de usuario al label
        const labelNombreUsuario = document.getElementById('nombreUsuario');
        labelNombreUsuario.textContent = nombreUsuario;
    
        const usuariosRegistrados = JSON.parse(localStorage.getItem('usuarios')) || [];
    
        const usuarioActual =usuariosRegistrados.find(usuario => usuario.correo === localStorage.getItem('correo'));
        
        
        const producto = {
            crearProducto: function(urlImagen, nombre, precio) {
                return {
                    urlImagen: urlImagen,
                    nombre: nombre,
                    precio: precio,
                    cantidad: 1
                };
            },
        
            agregarAlCarrito: function(usuarioActual, nuevoProducto, cantidad) {
                const productoEnCarrito = usuarioActual.carrito.find(producto => producto.nombre === nuevoProducto.nombre);

                if (productoEnCarrito) {
                    // Si el producto ya está en el carrito, sumar la cantidad seleccionada
                    productoEnCarrito.cantidad += cantidad;
                } else {
                    // Si no está en el carrito, agregar el nuevo producto con la cantidad seleccionada
                    nuevoProducto.cantidad = cantidad;
                    usuarioActual.carrito.push(nuevoProducto);
                }

                // Obtener la lista de usuarios del localStorage
                const usuariosRegistrados = JSON.parse(localStorage.getItem('usuarios')) || [];

                // Encontrar y actualizar al usuario actual en la lista
                const index = usuariosRegistrados.findIndex(u => u.correo === usuarioActual.correo);
                if (index !== -1) {
                    usuariosRegistrados[index] = usuarioActual;
                }

                // Guardar la lista actualizada en el localStorage
                localStorage.setItem('usuarios', JSON.stringify(usuariosRegistrados));

                alert('Producto agregado al carrito');
            }
        };
        
        //FUNCIONALIDAD AGREGAR CARRITO
            const btnAgregarCarrito1 = document.getElementById('btnAnadir');
            
            btnAgregarCarrito1.addEventListener('click', function(){
                const idProducto = this.getAttribute('data-producto-id');
                const nombreProducto = this.getAttribute('data-producto-nombre');
                const precio = this.getAttribute('data-producto-precio');
                const urlImagen = this.getAttribute('data-producto-urlimagen');
                // Obtener la cantidad seleccionada del HTML
                const cantidadSeleccionada = parseInt(document.getElementById('cantidad').textContent);
                stock=this.getAttribute('data=producto-stock');
                // Crear el producto
                const nuevoPro = producto.crearProducto(urlImagen,nombreProducto,precio,idProducto);

                // Agregar al carrito teniendo en cuenta la cantidad seleccionada
                producto.agregarAlCarrito(usuarioActual, nuevoPro, cantidadSeleccionada);
            })

        });

    // Obtener el elemento de la cantidad
    var cantidadElemento = document.getElementById("cantidad");

    // Función para decrementar la cantidad
    function decrementar() {
        var cantidad = parseInt(cantidadElemento.textContent);
        if (cantidad > 1) {
            cantidad--;
            cantidadElemento.textContent = cantidad;
        }
    }

    // Función para incrementar la cantidad
    function incrementar() {
        var cantidad = parseInt(cantidadElemento.textContent);
       
        cantidad++;
        
        cantidadElemento.textContent = cantidad;
    }

</script>
</html>